/*! SlimJS - v0.1.2 - 2016-05-16
* http://rsb.cc/SlimJS/
* Copyright (c) 2016 Ramon Barros; Licensed MIT */
!function(a){"use strict";var b="undefined"==typeof a,c=!b&&a.localStorage,d={};if(b)return void(module.exports=console);var e=c.andlogKey||"debug";if(c&&c[e]&&a.console)d=a.console;else for(var f="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),g=f.length,h=function(){};g--;)d[f[g]]=h;"undefined"!=typeof exports?module.exports=d:a.console=d}(window),function(a){"use strict";function b(){this.fake=!0,this.boundary="--------FormData"+Math.random(),this._fields=[]}a.FormData||(b.prototype.append=function(a,b){this._fields.push([a,b])},b.prototype.toString=function(){var a=this.boundary,b="";return this._fields.forEach(function(c){if(b+="--"+a+"\r\n",c[1].name){var d=c[1];b+='Content-Disposition: form-data; name="'+c[0]+'"; filename="'+d.name+'"\r\n',b+="Content-Type: "+d.type+"\r\n\r\n",b+=d.getAsBinary()+"\r\n"}else b+='Content-Disposition: form-data; name="'+c[0]+'";\r\n\r\n',b+=c[1]+"\r\n"}),b+="--"+a+"--"},a.FormData=b)}(window),function(a){"use strict";var b=function(){return this.system="app",this.protocol=a.document.location.protocol,this.host=a.document.location.host,this.hostname=a.document.location.hostname,this.origin=a.document.location.origin,this.port=a.document.location.port,this.pathname=a.document.location.pathname,this.baseurl=null,this.apiurl=null,this.__constructor()};return b.prototype.__constructor=function(){return console.log("Url:__constructor()"),this},b.prototype.setBase=function(a){return this.baseurl=a,this},b.prototype.setApi=function(a){return this.apiurl=a,this},b.prototype.cleanUri=function(a){return a.replace(/\/+/g,"/").replace(/^\/|\/($|\?)/,"").replace(/#\/?/,"")},b.prototype.baseUrl=function(a){return this.baseurl+(a||"")},b.prototype.apiUrl=function(a){return this.apiurl+(a||"")},b.prototype.redirect=function(b){a.location.href=b},b.prototype.setSystem=function(a){return this.system=a,this.system},b.prototype.segments=function(a){var b=this.pathname.replace(/(^\/|\/$)/g,""),c=String(b).split("/"),d=c.indexOf(this.system)+1;return c=c.slice(d,c.length),void 0!==typeof a?c[a]:c},a.Url=new b,b}(window),function(a){"use strict";var b=function(){return this.version="1.0.0",this.__constructor()};return b.prototype.__constructor=function(){return console.log("EventListener:__constructor()"),this.onhashchange(),this},b.prototype.onhashchange=function(){if("object"!=typeof a.onhashchange){var b=a.location,c=b.href,d=b.hash;setInterval(function(){var e=b.href,f=b.hash;f!==d&&"function"==typeof a.onhashchange&&(a.onhashchange({type:"hashchange",oldURL:c,newURL:e}),c=e,d=f)},100)}},b.prototype.addEvent=function(b,c,d){var e=0;if(a.document.addEventListener){if(b&&b.nodeName||b===a)b.addEventListener(c,d,!1);else if(b&&b.length)for(e;e<b.length;e++)a.EventListener.addEvent(b[e],c,d)}else if(b&&b.nodeName||b===a)b.document.body.attachEvent("on"+c,function(){return d.call(b,a.event,a.EventListener)});else if(b&&b.length)for(e;e<b.length;e++)a.EventListener.addEvent(b[e],c,d)},a.EventListener=new b,b}(window),function(a){"use strict";var b=function(){return this.__constructor()};return b.prototype.__constructor=function(){return console.log("Exceptions:__constructor()"),this.ajax(),this},b.prototype.jsonResponse=function(a){var b=[];return b[400]="Unrecognized command",b[401]="Permission denied",b[402]="Missing argument",b[401]="Incorrect password",b[404]="Page not found",b[405]="Email not validated",b[408]="Token expired",b[411]="Insufficient privileges",b[500]="Internal server error",b[a]},b.prototype.ajax=function(){var b=this;return $.ajaxSetup({statusCode:{401:function(){$.notify("A sessão foi fechada você será redirecionado para a tela de login!","warn"),setTimeout(function(){a.location.href=a.location.origin},5e3)}}}),$(document).ajaxError(function(a,c,d,e){console.log(a,c,d,e),$.notify("Desculpe, ocorreu um erro inesperado. ["+b.jsonResponse(c.status)+"]","error")}),this},a.Exceptions=new b,b}(window),function(a){"use strict";var b=function(){return this.system="app",this.options=null,this.env="local","localhost"===Url.host||/192\.168\.1/.test(Url.host)||/.dev/.test(Url.host)?localStorage.debug=!0:(delete localStorage.debug,this.env="prod"),this.__constructor()};return b.prototype.__constructor=function(){return console.log("Config:__constructor()"),this},b.prototype.loadOptions=function(a){console.log("Config:loadOptions");var b=this;return b.options=b.load("app.options"),b.options?(Url.setBase(b.options.baseUrl),Url.setApi(b.options.apiUrl),a(b.options)):b.getJsonAsync("config/"+b.env+".json").then(function(c){b.options=JSON.parse(c),b.save("app.options",b.options,1200),Url.setBase(b.options.baseUrl),Url.setApi(b.options.apiUrl),a(b.options)})["catch"](function(a){throw a}),this},b.prototype.getJsonAsync=function(a){return console.log("Config:getJsonAsync"),new Promise(function(b,c){console.log("Config:getJsonAsync() > Promise()");var d=new XMLHttpRequest;d.open("GET",a),d.onload=function(){200===d.status?b(d.response):c("Unable to load JSON")},d.onerror=function(){c("Unable to load JSON")},d.send(!0)})},b.prototype.save=function(a,b,c){if("undefined"==typeof Storage)return!1;var d={value:JSON.stringify(b),timestamp:(new Date).getTime()+c};return localStorage.setItem(a,JSON.stringify(d)),b},b.prototype.load=function(a){if("undefined"==typeof Storage)return!1;var b=JSON.parse(localStorage.getItem(a));return b?(new Date).getTime()<b.timestamp&&JSON.parse(b.value):!1},a.Config=new b,b}(window),function(a){"use strict";var b=function(){return this.data={},this.__constructor()};return b.prototype.__constructor=function(){return console.log("View:__constructor()"),this},b.prototype.setData=function(a,b){return this.data[a]=b,this},b.prototype.render=function(a,b,c){var d,e=this;return e.data=$.extend({},e.data,b),twig({href:a,async:!c,load:function(a){d=a.render(e.data),c||$(".app").html(d).fadeIn()}}),d},a.View=new b,b}(window),function(a){"use strict";var b=function(){return this.routes=[],this.mode=null,this.root=null,this.__constructor()};return b.prototype.__constructor=function(){return console.log("Router:__constructor()"),this.config({mode:"history"}),this},b.prototype.config=function(a){return this.mode=a&&a.mode&&"history"===a.mode&&history.pushState?"history":"hash",this.root=a&&a.root?"/"+this.clearSlashes(a.root)+"/":"/",this},b.prototype.getFragment=function(){var b="";if("history"===this.mode)b=this.clearSlashes(decodeURI(location.pathname+location.search)),b=b.replace(/\?(.*)$/,""),b="/"!==this.root?b.replace(this.root,""):b;else{var c=a.location.href.match(/#(.*)$/);b=c?c[1]:""}return this.clearSlashes(b)},b.prototype.clearSlashes=function(a){return a.toString().replace(/\/$/,"").replace(/^\//,"")},b.prototype.add=function(a,b){return"function"==typeof a&&(b=a,a=""),this.routes.push({re:a,handler:b}),this},b.prototype.remove=function(a){for(var b,c=0;c<this.routes.length;c++)if(b=this.routes[c],b.handler===a||b.re.toString()===a.toString())return this.routes.splice(c,1),this;return this},b.prototype.flush=function(){return this.routes=[],this.mode=null,this.root="/",this},b.prototype.check=function(a){for(var b=a||this.getFragment(),c=0;c<this.routes.length;c++){var d=b.match(this.routes[c].re);if(d)return d.shift(),this.routes[c].handler.apply({},d),this}return this},b.prototype.listen=function(){var a=this,b=a.getFragment(),c=function(){b!==a.getFragment()&&(b=a.getFragment(),a.check(b))};return clearInterval(this.interval),this.interval=setInterval(c,50),this},b.prototype.navigate=function(b){return b=b?b:"","history"===this.mode?history.pushState(null,null,this.root+this.clearSlashes(b)):a.location.href=a.location.href.replace(/#(.*)$/,"")+"#"+b,this},b.prototype.get=function(a,b){this.add(a,b)},a.Router=b,b}(window),function(a){"use strict";var b=function(){return this.view=null,this.router=null,this.options=null,this.params=[],this.routes={},this.routes.get={},this.routes.post={},this.routes.put={},this.hooks={"app.before":function(){console.log("Core:hook.before")},"app.after":function(){console.log("Core:hook.after")}},this.__constructor()};return b.prototype.__constructor=function(){return console.log("Core:__constructor()"),this.view=View,this.router=Router,this},b.prototype.setDefaultRouter=function(a){this.defaultRouter=a},b.prototype.setHash=function(b){var c,d,e,f;return"/"===b?c="#/":(b=Url.cleanUri(b),c="#/"+(b.length>0?b:"")),a.location.hash!==c?a.location.hash=c:this.routes.get.hasOwnProperty(b)?this.routes.get[b].apply(this,this.params):(c=c.replace(/([\?\&]time=[^\&]+)/,""),d=c.split("&"),c=d.shift(),e=d.length>0?"&"+d.join("&"):"",c+=e,f=/\?/.test(c)?"&":"?",a.location.hash=c+(f+"time="+(new Date).getTime())),this},b.prototype.routers=function(){console.log("Core:routers()");var b=this;if($(document).on("click","[ui-sref]",function(a){a.preventDefault();var c=$(this).attr("ui-sref");console.log("Core:click[ui-sref]["+c+"]"),b.setHash(c)}),$(document).on("submit","form",function(a){console.log("Core:form.submit"),a.stopPropagation(),a.preventDefault();var c=a.originalEvent.currentTarget.activeElement,d=$(c),e=$(this).attr("action"),f=$(this).attr("enctype"),g=($("input[name=_METHOD]").val()||$("form").attr("method")).toLowerCase(),h=$(this).serialize();if(!b.routes.hasOwnProperty(g))throw"Rota não encontrada["+g+":"+e+"]!";if(!b.routes[g].hasOwnProperty(e))throw"Rota não encontrada ["+g+":"+e+"]!";b.params=[],"multipart/form-data"===f&&(h=new FormData(a.target)),b.params.push(h),d.button("loading"),b.routes[g][e].apply(b,b.params),d.button("reset")}),a.location.hash.length>0){var c=Url.cleanUri(a.location.hash);b.setHash(c)}else this.defaultRouter&&b.setHash(this.defaultRouter)},b.prototype.getParamsFromRouter=function(a,b,c){var d={},e={},f=a.split("/",50);if(f.length<b.length)return!1;for(var g=0;g<f.length;g++){var h=f[g],i=b[g];if(void 0!==i){if(":"===h.charAt(0)){d[h.substr(1)]=i;continue}if(h!==i)return!1}else{if(":"!==h.charAt(0))return!1;e[h.substr(1)]=!0}}for(var j=0;j<c.length;j++){var k=c[j].split("=",2),l=k[0];2!==k.length||d[l]||e[l]||(d[l]=k[1])}return d},b.prototype.render=function(a,b,c){return this.view.render(Url.baseUrl(a),b,c)},b.prototype.redirect=function(b,c){var d=a.Core;if(d.routes.get.hasOwnProperty(b)){d.params=[];for(var e in c)d.params.push(c[e]);d.setHash(b)}},b.prototype.hook=function(b,c){var d=a.Core;return d.hooks.hasOwnProperty(b)&&(d.hooks[b]=c,d.hooks["app.before"].apply(d)),this},b.prototype.get=function(a,b){this.routes.get[a.replace(/^\//,"")]=b},b.prototype.post=function(a,b){this.routes.post[a.replace(/^\//,"")]=b},b.prototype.put=function(a,b){this.routes.put[a.replace(/^\//,"")]=b},b.prototype.submit=function(a){this.request("POST",Url.apiUrl(""),a)},b.prototype.request=function(a,b,c,d){console.log("Core:request["+a+"]["+b+"]");var e,f=!(c instanceof FormData),g=c instanceof FormData?!1:"application/x-www-form-urlencoded; charset=UTF-8",h=!1;return e=$.ajax({method:a||"GET",url:b||Url.apiUrl(),data:c||{},processData:f,contentType:g,dataType:"json",async:d||!0}).done(function(){h&&$.notify("Ok!","success")}).fail(function(){h&&$.notify("Error!","error")}).always(function(){h&&$.notify("Complete!","warn")})},a.Core=new b,a.Core.hooks["app.before"].apply(a.Core),EventListener.addEvent(a,"load",function(){a.Core.hooks["app.after"].apply(a.Core)}),EventListener.addEvent(a,"hashchange",function(){a.Core.hooks["app.before"].apply(a.Core);var b=a.Url.cleanUri(a.location.hash),c=b.split("?",2),d=c[0].split("/",50),e=c[1]?c[1].split("&",50):[];if(a.Core.routes.get.hasOwnProperty(b))a.Core.routes.get[b].apply(a.Core,a.Core.params);else{var f=!1;$.each(a.Core.routes.get,function(b,c){var g=a.Core.getParamsFromRouter(b,d,e);if(g){a.Core.params=[];for(var h in g)a.Core.params.push(g[h]);f=!0,c.apply(a.Core,a.Core.params)}}),f||(a.location.href="404.html")}}),b}(window),function(a){"use strict";var b=function(){return this.__constructor()};return b.prototype=Core,b.prototype.constructor=b,b.prototype.__constructor=function(){return console.log("Slim:__constructor()"),this},b.prototype.baseUrl=function(a){return Url.baseUrl(a)},b.prototype.apiUrl=function(a){return Url.apiUrl(a)},b.prototype.api=function(a){console.log("Slim:api");var b,c,d;switch(a){case"check":b="OPTIONS",c=Url.apiUrl();break;default:b="OPTIONS",c=Url.apiUrl()}return this.request(b,c,d)},b.prototype.run=function(a){return console.log("Slim:run"),Config.loadOptions(a)},b.prototype.flash=function(a,b,c){return console.log("Slim:flash"),$("form").notify(a,{className:b||"warn",position:c||"top center"}),this},a.$app=new b,a.$app}(window);